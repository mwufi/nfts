import{config as e}from"@onflow/config";import{invariant as n}from"@onflow/util-invariant";import{Transaction as t,SendTransactionRequest as r,AccessAPI as o,GetTransactionRequest as a,ExecuteScriptAtBlockIDRequest as u,ExecuteScriptAtBlockHeightRequest as i,ExecuteScriptAtLatestBlockRequest as s,GetAccountAtBlockHeightRequest as c,GetAccountAtLatestBlockRequest as l,GetEventsForHeightRangeRequest as f,GetEventsForBlockIDsRequest as d,GetLatestBlockRequest as m,GetBlockByIDRequest as g,GetBlockByHeightRequest as p,PingRequest as h}from"@onflow/protobuf";import{sansPrefix as v,withPrefix as y}from"@onflow/util-address";import{grpc as b}from"@improbable-eng/grpc-web";import{NodeHttpTransport as k}from"@improbable-eng/grpc-web-node-http-transport";import{encode as I}from"@onflow/rlp";import{template as P}from"@onflow/util-template";export{template as cadence,template as cdc}from"@onflow/util-template";function S(){return(S=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e}).apply(this,arguments)}function w(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}var A='{\n  "tag":"UNKNOWN",\n  "assigns":{},\n  "status":"OK",\n  "reason":null,\n  "accounts":{},\n  "params":{},\n  "arguments":{},\n  "message": {\n    "cadence":null,\n    "refBlock":null,\n    "computLimit":null,\n    "proposer":null,\n    "payer":null,\n    "authorizations":[],\n    "params":[],\n    "arguments":[]\n  },\n  "proposer":null,\n  "authorizations":[],\n  "payer":null,\n  "events": {\n    "eventType":null,\n    "start":null,\n    "end":null,\n    "blockIds":[]\n  },\n  "transaction": {\n    "id":null\n  },\n  "block": {\n    "id":null,\n    "height":null,\n    "isSealed":null\n  },\n  "account": {\n    "addr":null\n  }\n}',B=new Set(Object.keys(JSON.parse(A))),T=function(){return JSON.parse(A)},x=function(e){return Array.isArray(e)},N=function(e){return null==e},E="abcdefghijklmnopqrstuvwxyz0123456789".split(""),j=function(){return E[~~(Math.random()*E.length)]},O=function(){return Array.from({length:10},j).join("")},L=function(e){return e.status="OK",e},_=function(e,n){return e.status="BAD",e.reason=n,e},U=function(e){return function(n){return n.tag=e,L(n)}},C=function(e,n){return function(t){return t.accounts[n]=JSON.parse('{\n  "kind":"ACCOUNT",\n  "tempId":null,\n  "addr":null,\n  "keyId":null,\n  "sequenceNum":null,\n  "signature":null,\n  "signingFunction":null,\n  "resolve":null,\n  "role": {\n    "proposer":false,\n    "authorizer":false,\n    "payer":false,\n    "param":false\n  }\n}'),t.accounts[n].tempId=n,t.accounts[n].addr=e.addr,t.accounts[n].keyId=e.keyId,t.accounts[n].sequenceNum=e.sequenceNum,t.accounts[n].signature=e.signature,t.accounts[n].signingFunction=e.signingFunction,t.accounts[n].resolve=e.resolve,t.accounts[n].role=S({},t.accounts[n].role,e.role),L(t)}},K=function(e){return function(n){var t=O();return n.message.params.push(t),n.params[t]=JSON.parse('{\n  "kind":"PARAM",\n  "tempId":null,\n  "key":null,\n  "value":null,\n  "asParam":null,\n  "xform":null,\n  "resolve": null\n}'),n.params[t].tempId=t,n.params[t].key=e.key,n.params[t].value=e.value,n.params[t].asParam=e.asParam,n.params[t].xform=e.xform,n.params[t].resolve=e.resolve,L(n)}},R=function(e){return function(n){var t=O();return n.message.arguments.push(t),n.arguments[t]=JSON.parse('{\n  "kind":"ARGUMENT",\n  "tempId":null,\n  "value":null,\n  "asArgument":null,\n  "xform":null,\n  "resolve": null\n}'),n.arguments[t].tempId=t,n.arguments[t].value=e.value,n.arguments[t].asArgument=e.asArgument,n.arguments[t].xform=e.xform,n.arguments[t].resolve=e.resolve,L(n)}},D=U("SCRIPT"),G=U("TRANSACTION"),z=U("GET_TRANSACTION_STATUS"),F=U("GET_TRANSACTION"),H=U("GET_ACCOUNT"),q=U("GET_EVENTS"),J=U("GET_LATEST_BLOCK"),M=U("GET_BLOCK_BY_ID"),W=U("GET_BLOCK_BY_HEIGHT"),Y=U("PING"),V=U("GET_BLOCK"),$=U("GET_BLOCK_HEADER"),X=function(e){return function(n){return n.tag===e}},Q=X("UNKNOWN"),Z=X("SCRIPT"),ee=X("TRANSACTION"),ne=X("GET_TRANSACTION_STATUS"),te=X("GET_TRANSACTION"),re=X("GET_ACCOUNT"),oe=X("GET_EVENTS"),ae=X("GET_LATEST_BLOCK"),ue=X("GET_BLOCK_BY_ID"),ie=X("GET_BLOCK_BY_HEIGHT"),se=X("PING"),ce=X("GET_BLOCK"),le=X("GET_BLOCK_HEADER"),fe=function(e){return"OK"===e.status},de=function(e){return"BAD"===e.status},me=function(e){return e.reason},ge=function e(n,t){void 0===t&&(t=[]);try{return Promise.resolve(function(r,o){try{var a=Promise.resolve(n).then(function(r){if(n=function(e){for(var n=0,t=Object.keys(e);n<t.length;n++){var r=t[n];if(!B.has(r))throw new Error('"'+r+'" is an invalid root level Interaction property.')}return e}(r),de(n))throw new Error("Interaction Error: "+n.reason);if(!t.length)return n;var o=t[0],a=t.slice(1);return Promise.resolve(o).then(function(t){if("function"==typeof t)return e(t(n),a);if(N(t)||!t)return e(n,a);if(function(e){if("object"!=typeof e||N(e)||"number"===e)return!1;for(var n,t=function(e,n){var t;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(t=function(e,n){if(e){if("string"==typeof e)return w(e,void 0);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?w(e,void 0):void 0}}(e))){t&&(e=t);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(t=e[Symbol.iterator]()).next.bind(t)}(B);!(n=t()).done;)if(!e.hasOwnProperty(n.value))return!1;return!0}(t))return e(t,a);throw new Error("Invalid Interaction Composition")})})}catch(e){return o(e)}return a&&a.then?a.then(void 0,o):a}(0,function(e){throw e}))}catch(e){return Promise.reject(e)}},pe=function e(){var n=[].slice.call(arguments),t=n[0],r=n[1];return x(t)&&null==r?function(n){return e(n,t)}:ge(t,r)},he=function(e){return e},ve=function(e,n,t){return null==e.assigns[n]?t:e.assigns[n]},ye=function(e,n){return function(t){return t.assigns[e]=n,L(t)}},be=function(e,n){return void 0===n&&(n=he),function(t){return t.assigns[e]=n(t.assigns[e],t),L(t)}},ke=function(e){return function(n){return delete n.assigns[e],L(n)}};function Ie(e){return void 0===e&&(e=[]),pe(T(),e)}var Pe=function(){return JSON.parse('{"tag": 0, "transaction":null, "transactionId":null, "encodedData":null, "events": null, "account": null}')},Se=function(e,n,t){try{return Promise.resolve(new Promise(function(r,o){b.unary(n,{request:t,host:e,onEnd:function(e){var n=e.statusMessage;e.status===b.Code.OK?r(e.message):o(new Error(n))}})}))}catch(e){return Promise.reject(e)}};b.setDefaultTransport(k());var we=function(e){return Buffer.from(e,"hex")},Ae=function(e){return Buffer.from(e.padStart(16,0),"hex")},Be=function(e){return Buffer.from(e).toString("hex")},Te=function(e){return Buffer.from(e).toString("hex")},xe=function(e){return Buffer.from(e).toString("hex")},Ne=function(e){return Buffer.from(e).toString("hex")},Ee=function(e){return Buffer.from(e).toString("hex")},je=function(n,b){void 0===b&&(b={});try{var k=function(e){return b.node=e,Promise.resolve(n).then(function(e){switch(n=e,!0){case ee(n):return function(e,n){void 0===n&&(n={});try{return Promise.resolve(e).then(function(a){e=a;var u=new t;u.setScript(function(e){return Buffer.from(e,"utf8")}(e.message.cadence)),u.setGasLimit(e.message.computeLimit),u.setReferenceBlockId(e.message.refBlock?we(e.message.refBlock):null),u.setPayer(Ae(v(e.accounts[e.payer].addr))),e.message.arguments.forEach(function(n){return u.addArguments(function(e){return Buffer.from(JSON.stringify(e),"utf8")}(e.arguments[n].asArgument))}),e.authorizations.map(function(n){return e.accounts[n].addr}).reduce(function(e,n){return e.find(function(e){return e===n})?e:[].concat(e,[n])},[]).forEach(function(e){return u.addAuthorizers(Ae(v(e)))});var i=new t.ProposalKey;i.setAddress(Ae(v(e.accounts[e.proposer].addr))),i.setKeyId(e.accounts[e.proposer].keyId),i.setSequenceNumber(e.accounts[e.proposer].sequenceNum),u.setProposalKey(i);for(var s=0,c=Object.values(e.accounts);s<c.length;s++){var l=c[s];try{if(!l.role.payer&&null!=l.signature){var f=new t.Signature;f.setAddress(Ae(v(l.addr))),f.setKeyId(l.keyId),f.setSignature(we(l.signature)),u.addPayloadSignatures(f)}}catch(n){throw console.error("Trouble applying payload signature",{acct:l,ix:e}),n}}for(var d=0,m=Object.values(e.accounts);d<m.length;d++){var g=m[d];try{if(g.role.payer&&null!=g.signature){var p=new t.Signature;p.setAddress(Ae(v(g.addr))),p.setKeyId(g.keyId),p.setSignature(we(g.signature)),u.addEnvelopeSignatures(p)}}catch(n){throw console.error("Trouble applying envelope signature",{acct:g,ix:e}),n}}var h=new r;h.setTransaction(u);var y=Date.now();return Promise.resolve(Se(n.node,o.SendTransaction,h)).then(function(n){var t,r=Date.now(),o=Pe();return o.tag=e.tag,o.transactionId=(t=n.getId_asU8(),Buffer.from(t).toString("hex")),"undefined"!=typeof window&&window.dispatchEvent(new CustomEvent("FLOW::TX",{detail:{txId:o.transactionId,delta:r-y}})),o})})}catch(e){return Promise.reject(e)}}(n,b);case ne(n):return function(e,n){void 0===n&&(n={});try{return Promise.resolve(e).then(function(t){e=t;var r=new a;return r.setId(Buffer.from(e.transaction.id,"hex")),Promise.resolve(Se(n.node,o.GetTransactionResult,r)).then(function(n){var t=n.getEventsList(),r=Pe();return r.tag=e.tag,r.transaction={status:n.getStatus(),statusCode:n.getStatusCode(),errorMessage:n.getErrorMessage(),events:t.map(function(e){return{type:e.getType(),transactionId:(n=e.getTransactionId_asU8(),Buffer.from(n).toString("hex")),transactionIndex:e.getTransactionIndex(),eventIndex:e.getEventIndex(),payload:JSON.parse(Buffer.from(e.getPayload_asU8()).toString("utf8"))};var n})},r})})}catch(e){return Promise.reject(e)}}(n,b);case te(n):return function(e,n){void 0===n&&(n={});try{return Promise.resolve(e).then(function(t){e=t;var r=new a;return r.setId(Buffer.from(e.transaction.id,"hex")),Promise.resolve(Se(n.node,o.GetTransaction,r)).then(function(n){n.getEventsList();var t=Pe();t.tag=e.tag;var r=function(e){return{address:Be(key.getAddress_asU8()),keyId:key.getKeyId(),signature:Be(key.getSequenceNumber_asU8())}},o=t.getTransaction();return t.transaction={script:Be(o.getScript_asU8()),_arguments2:o.getArgumentsList().map(Be),referenceBlockId:Be(o.getReferenceBlockId_asU8()),gasLimit:o.getGasLimit(),proposalKey:function(e){return{address:Be(e.getAddress_asU8()),keyId:e.getKeyId(),sequenceNumber:e.getSequenceNumber()}}(o.getProposalKey()),payer:Be(o.getPayer_asU8()),authorizers:o.getAuthorizersList().map(Be),payloadSignatures:o.getPayloadSignaturesList().map(r),envelopeSignatures:o.getEnvelopeSignaturesList().map(r)},t})})}catch(e){return Promise.reject(e)}}(n,b);case Z(n):return function(e,n){void 0===n&&(n={});try{return Promise.resolve(e).then(function(t){var r;(e=t).block.id?(r=new u).setBlockId(Buffer.from(e.block.id,"hex")):e.block.height?(r=new i).setBlockHeight(Number(e.block.height)):r=new s;var a=Buffer.from(e.message.cadence,"utf8");return e.message.arguments.forEach(function(n){return r.addArguments(function(e){return Buffer.from(JSON.stringify(e),"utf8")}(e.arguments[n].asArgument))}),r.setScript(a),Promise.resolve(Se(n.node,o.ExecuteScriptAtLatestBlock,r)).then(function(n){var t=Pe();return t.tag=e.tag,t.encodedData=JSON.parse(Buffer.from(n.getValue_asU8()).toString("utf8")),t})})}catch(e){return Promise.reject(e)}}(n,b);case re(n):return function(e,n){void 0===n&&(n={});try{return Promise.resolve(e).then(function(t){var r,a=(e=t).block.height?new c:new l;return e.block.height&&a.setHeight(Number(e.block.height)),a.setAddress((r=v(e.account.addr),Buffer.from(r.padStart(16,0),"hex"))),Promise.resolve(Se(n.node,o.GetAccount,a)).then(function(n){var t=Pe();t.tag=e.tag;var r,o=n.getAccount(),a=(r=o.getContractsMap())?r.getEntryList().reduce(function(e,n){var t;return S({},e,((t={})[n[0]]=new TextDecoder("utf-8").decode(n[1]||new UInt8Array),t))},{}):{};return t.account={address:y(Te(o.getAddress_asU8())),balance:o.getBalance(),code:new TextDecoder("utf-8").decode(o.getCode_asU8()||new UInt8Array),contracts:a,keys:o.getKeysList().map(function(e){return{index:e.getIndex(),publicKey:Te(e.getPublicKey_asU8()),signAlgo:e.getSignAlgo(),hashAlgo:e.getHashAlgo(),weight:e.getWeight(),sequenceNumber:e.getSequenceNumber(),revoked:e.getRevoked()}})},t})})}catch(e){return Promise.reject(e)}}(n,b);case oe(n):return function(e,n){void 0===n&&(n={});try{return Promise.resolve(e).then(function(t){var r=(e=t).events.start?new f:new d;return r.setType(e.events.eventType),e.events.start?(r.setStartHeight(Number(e.events.start)),r.setEndHeight(Number(e.events.end))):e.events.blockIds.forEach(function(e){return r.addBlockIds(Buffer.from(e,"hex"))}),Promise.resolve(Se(n.node,o.GetEventsForHeightRange,r)).then(function(n){var t=Pe();t.tag=e.tag;var r=n.getResultsList();return t.events=r.reduce(function(e,n){var t=n.getBlockId(),r=n.getBlockHeight(),o=n.getBlockTimestamp();return n.getEventsList().forEach(function(n){var a;e.push({blockId:t,blockHeight:r,blockTimestamp:o,type:n.getType(),transactionId:(a=n.getTransactionId_asU8(),Buffer.from(a).toString("hex")),transactionIndex:n.getTransactionIndex(),eventIndex:n.getEventIndex(),payload:JSON.parse(Buffer.from(n.getPayload_asU8()).toString("utf8"))})}),e},[]),t})})}catch(e){return Promise.reject(e)}}(n,b);case ae(n):case ce(n):return function(e,n){void 0===n&&(n={});try{return Promise.resolve(e).then(function(t){e=t;var r=new m;return e.latestBlock&&e.latestBlock.isSealed&&(r.setIsSealed(e.latestBlock.isSealed),console.error("\n          %c@onflow/send Deprecation Notice\n          ========================\n\n          Operating upon data of the latestBlock field of the interaction object is deprecated and will no longer be recognized in future releases of @onflow/send.\n          Find out more here: https://github.com/onflow/flow-js-sdk/blob/master/packages/send/WARNINGS.md#0001-Deprecating-latestBlock-field\n\n          =======================\n        ".replace(/\n\s+/g,"\n").trim(),"font-weight:bold;font-family:monospace;")),e.block&&e.block.isSealed&&r.setIsSealed(e.block.isSealed),Promise.resolve(Se(n.node,o.GetLatestBlock,r)).then(function(n){var t=n.getBlock(),r=t.getCollectionGuaranteesList(),o=t.getBlockSealsList(),a=t.getSignaturesList(),u=Pe();return u.tag=e.tag,u.block={id:xe(t.getId_asU8()),parentId:xe(t.getParentId_asU8()),height:t.getHeight(),timestamp:t.getTimestamp(),collectionGuarantees:r.map(function(e){return{collectionId:xe(e.getCollectionId_asU8()),signatures:e.getSignaturesList()}}),blockSeals:o.map(function(e){return{blockId:xe(e.getBlockId_asU8()),executionReceiptId:xe(e.getExecutionReceiptId_asU8()),executionReceiptSignatures:e.getExecutionReceiptSignaturesList(),resultApprovalSignatures:e.getResultApprovalSignaturesList()}}),signatures:a},u})})}catch(e){return Promise.reject(e)}}(n,b);case ue(n):return function(e,n){void 0===n&&(n={});try{return Promise.resolve(e).then(function(t){e=t;var r=new g;return r.setId(Buffer.from(e.block.id,"hex")),Promise.resolve(Se(n.node,o.GetBlockByID,r)).then(function(n){var t=n.getBlock(),r=t.getCollectionGuaranteesList(),o=t.getBlockSealsList(),a=t.getSignaturesList(),u=Pe();return u.tag=e.tag,u.block={id:Ne(t.getId_asU8()),parentId:Ne(t.getParentId_asU8()),height:t.getHeight(),timestamp:t.getTimestamp(),collectionGuarantees:r.map(function(e){return{collectionId:Ne(e.getCollectionId_asU8()),signatures:e.getSignaturesList()}}),blockSeals:o.map(function(e){return{blockId:Ne(e.getBlockId_asU8()),executionReceiptId:Ne(e.getExecutionReceiptId_asU8()),executionReceiptSignatures:e.getExecutionReceiptSignaturesList(),resultApprovalSignatures:e.getResultApprovalSignaturesList()}}),signatures:a},u})})}catch(e){return Promise.reject(e)}}(n,b);case ie(n):return function(e,n){void 0===n&&(n={});try{return Promise.resolve(e).then(function(t){e=t;var r=new p;return r.setHeight(Number(e.block.height)),Promise.resolve(Se(n.node,o.GetBlockByHeight,r)).then(function(n){var t=n.getBlock(),r=t.getCollectionGuaranteesList(),o=t.getBlockSealsList(),a=t.getSignaturesList(),u=Pe();return u.tag=e.tag,u.block={id:Ee(t.getId_asU8()),parentId:Ee(t.getParentId_asU8()),height:t.getHeight(),timestamp:t.getTimestamp(),collectionGuarantees:r.map(function(e){return{collectionId:Ee(e.getCollectionId_asU8()),signatures:e.getSignaturesList()}}),blockSeals:o.map(function(e){return{blockId:Ee(e.getBlockId_asU8()),executionReceiptId:Ee(e.getExecutionReceiptId_asU8()),executionReceiptSignatures:e.getExecutionReceiptSignaturesList(),resultApprovalSignatures:e.getResultApprovalSignaturesList()}}),signatures:a},u})})}catch(e){return Promise.reject(e)}}(n,b);case se(n):return function(e,n){void 0===n&&(n={});try{return Promise.resolve(e).then(function(t){e=t;var r=new h;return Promise.resolve(Se(n.node,o.Ping,r)).then(function(n){var t=Pe();return t.tag=e.tag,t})})}catch(e){return Promise.reject(e)}}(n,b);default:return n}})},I=b.node;return Promise.resolve(I?k(I):Promise.resolve(e().get("accessNode.api")).then(k))}catch(e){return Promise.reject(e)}};function Oe(e){return void 0===e&&(e=null),pe([V,function(n){return n.block.isSealed=e,L(n)}])}function Le(e){return pe([H,function(n){return n.account.addr=v(e),L(n)}])}var _e=function(e,n,t){try{try{return Promise.resolve(Number(e))}catch(e){throw new Error("Decode Number Error : "+t.join("."))}}catch(e){return Promise.reject(e)}},Ue=function(e){return Promise.resolve(e)},Ce=function(e,n,t){try{return Promise.resolve(e.fields.reduce(function(e,r){try{return Promise.resolve(e).then(function(o){return e=o,Promise.resolve(De(r.value,n,[].concat(t,[r.name]))).then(function(n){return e[r.name]=n,e})})}catch(e){return Promise.reject(e)}},Promise.resolve({}))).then(function(t){var r=e.id&&Re(n,e.id);return r?Promise.resolve(r(t)):t})}catch(e){return Promise.reject(e)}},Ke={UInt:_e,Int:_e,UInt8:_e,Int8:_e,UInt16:_e,Int16:_e,UInt32:_e,Int32:_e,UInt64:_e,Int64:_e,UInt128:_e,Int128:_e,UInt256:_e,Int256:_e,Word8:_e,Word16:_e,Word32:_e,Word64:_e,UFix64:Ue,Fix64:Ue,String:Ue,Character:Ue,Bool:Ue,Address:Ue,Void:function(){return Promise.resolve(null)},Optional:function(e,n,t){return Promise.resolve(e?De(e,n,t):null)},Reference:function(e){try{return Promise.resolve({address:e.address,type:e.type})}catch(e){return Promise.reject(e)}},Array:function(e,n,t){try{return Promise.resolve(Promise.all(e.map(function(e){return new Promise(function(r){try{return Promise.resolve(De(e,n,[].concat(t,[e.type]))).then(r)}catch(e){return Promise.reject(e)}})})))}catch(e){return Promise.reject(e)}},Dictionary:function(e,n,t){try{return Promise.resolve(e.reduce(function(e,r){try{return Promise.resolve(e).then(function(o){return e=o,Promise.resolve(De(r.key,n,[].concat(t,[r.key]))).then(function(o){return Promise.resolve(De(r.value,n,[].concat(t,[r.key]))).then(function(n){return e[o]=n,e})})})}catch(e){return Promise.reject(e)}},Promise.resolve({})))}catch(e){return Promise.reject(e)}},Event:Ce,Resource:Ce,Struct:Ce},Re=function(e,n){var t=Object.keys(e).find(function(e){return/^\/.*\/$/.test(e)?new RegExp(e.substring(1,e.length-1)).test(n):e===n});return n&&t&&e[t]},De=function(e,n,t){try{var r=Re(n,e.type);if(!r)throw new Error("Undefined Decoder Error: "+e.type+"@"+t.join("."));return Promise.resolve(r(e.value,n,t))}catch(e){return Promise.reject(e)}},Ge=function(e,n,t){void 0===n&&(n={}),void 0===t&&(t=[]);var r=S({},Ke,n);return Promise.resolve(De(e,r,t))},ze=function(e,n){void 0===n&&(n={});try{var t,r=S({},Ke,n),o=e.encodedData?(t=1,Promise.resolve(Ge(e.encodedData,r))):e.transaction?(t=1,Promise.resolve(Promise.all(e.transaction.events.map(function(e){try{var n=e.eventIndex,t=e.transactionIndex,o=e.transactionId,a=e.type;return Promise.resolve(Ge(e.payload,r)).then(function(e){return{type:a,transactionId:o,transactionIndex:t,eventIndex:n,data:e}})}catch(e){return Promise.reject(e)}}))).then(function(n){return S({},e.transaction,{events:n})})):e.events?(t=1,Promise.resolve(Promise.all(e.events.map(function(e){try{var n=e.eventIndex,t=e.transactionIndex,o=e.transactionId,a=e.type;return Promise.resolve(Ge(e.payload,r)).then(function(e){return{type:a,transactionId:o,transactionIndex:t,eventIndex:n,data:e}})}catch(e){return Promise.reject(e)}})))):e.account?(t=1,e.account):e.block?(t=1,e.block):e.blockHeader?(t=1,e.blockHeader):e.latestBlock?(console.error("\n          %c@onflow/decode Deprecation Notice\n          ========================\n\n          Operating upon data of the latestBlock field of the response object is deprecated and will no longer be recognized in future releases of @onflow/decode.\n          Find out more here: https://github.com/onflow/flow-js-sdk/blob/master/packages/decode/WARNINGS.md#0001-Deprecating-latestBlock-field\n\n          =======================\n        ".replace(/\n\s+/g,"\n").trim(),"font-weight:bold;font-family:monospace;"),t=1,e.latestBlock):e.transactionId?(t=1,e.transactionId):void 0;return Promise.resolve(o&&o.then?o.then(function(e){return t?e:null}):t?o:null)}catch(e){return Promise.reject(e)}};function Fe(e){return function(n){try{return ee(n)?n.message.refBlock?Promise.resolve(L(n)):Promise.resolve(function(e){try{var n;return Promise.resolve(pe(T(),[Oe()])).then(function(t){return n=t,Promise.resolve(je(n,e)).then(function(e){return n=e,Promise.resolve(ze(n)).then(function(e){return(n=e).id})})})}catch(e){return Promise.reject(e)}}(e)).then(function(e){return n.message.refBlock=e,L(n)}):Promise.resolve(L(n))}catch(e){return Promise.reject(e)}}}var He=function(t){try{var r=function(){if(ee(t)||Z(t)){var r=function(){return n(Je(o),"Cadence needs to be a string at this point."),Promise.resolve(e().where(/^0x/).then(function(e){return Object.entries(e).reduce(function(e,n){return e.replace(n[0],n[1])},o)})).then(function(e){t.message.cadence=e})},o=ve(t,"ix.cadence");n(qe(o)||Je(o),"Cadence needs to be a function or a string.");var a=function(){if(qe(o))return Promise.resolve(o({})).then(function(e){o=e})}();return a&&a.then?a.then(r):r()}}();return Promise.resolve(r&&r.then?r.then(function(){return t}):t)}catch(e){return Promise.reject(e)}},qe=function(e){return"function"==typeof e},Je=function(e){return"string"==typeof e},Me=function(e){try{if(ee(e)||Z(e))for(var n=0,t=Object.entries(e.arguments);n<t.length;n++){var r=t[n];e.arguments[r[0]].asArgument=Ye(r[1])}return Promise.resolve(e)}catch(e){return Promise.reject(e)}},We=function(e){return"function"==typeof e};function Ye(e){return n(null!=typeof e.xform,"No type specified for argument: "+e.value),We(e.xform)?e.xform(e.value):We(e.xform.asArgument)?e.xform.asArgument(e.value):void n(!1,"Invalid Argument",e)}var Ve="undefined"!=typeof Symbol?Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator")):"@@iterator";function $e(e,n,t){if(!e.s){if(t instanceof Xe){if(!t.s)return void(t.o=$e.bind(null,e,n));1&n&&(n=t.s),t=t.v}if(t&&t.then)return void t.then($e.bind(null,e,n),$e.bind(null,e,2));e.s=n,e.v=t;var r=e.o;r&&r(e)}}var Xe=function(){function e(){}return e.prototype.then=function(n,t){var r=new e,o=this.s;if(o){var a=1&o?n:t;if(a){try{$e(r,1,a(this.v))}catch(e){$e(r,2,e)}return r}return this}return this.o=function(e){try{var o=e.v;1&e.s?$e(r,1,n?n(o):o):t?$e(r,1,t(o)):$e(r,2,o)}catch(e){$e(r,2,e)}},r},e}();function Qe(e){return e instanceof Xe&&1&e.s}var Ze=function(e){try{var n=function(){if(ee(e))return function(n,t){try{var r=Promise.resolve(en(e,Object.values(e.accounts))).then(function(){return Promise.resolve(en(e,Object.values(e.accounts))).then(function(){})})}catch(e){return t(e)}return r&&r.then?r.then(void 0,t):r}(0,function(e){throw console.error("=== SAD PANDA ===\n\n",e,"\n\n=== SAD PANDA ==="),e})}();return Promise.resolve(n&&n.then?n.then(function(n){return e}):e)}catch(e){return Promise.reject(e)}},en=function e(t,r,o,a){void 0===a&&(a=3);try{var u=function(){o&&(t.authorizations=t.authorizations.map(function(e){return e===o.tempId?i:e}).reduce(function(e,n){return Array.isArray(n)?[].concat(e,n):[].concat(e,[n])},[]))};n(a,"Account Resolve Recursion Limit Exceeded",{ix:t,accounts:r});var i=[],s=function(e,n,t){if("function"==typeof e[Ve]){var r,o,a,u=e[Ve]();if(function e(t){try{for(;!(r=u.next()).done;)if((t=n(r.value))&&t.then){if(!Qe(t))return void t.then(e,a||(a=$e.bind(null,o=new Xe,2)));t=t.v}o?$e(o,1,t):o=t}catch(e){$e(o||(o=new Xe),2,e)}}(),u.return){var i=function(e){try{r.done||u.return()}catch(e){}return e};if(o&&o.then)return o.then(i,function(e){throw i(e)});i()}return o}if(!("length"in e))throw new TypeError("Object is not iterable");for(var s=[],c=0;c<e.length;c++)s.push(e[c]);return function(e,n,t){var r,o,a=-1;return function t(u){try{for(;++a<e.length;)if((u=n(a))&&u.then){if(!Qe(u))return void u.then(t,o||(o=$e.bind(null,r=new Xe,2)));u=u.v}r?$e(r,1,u):r=u}catch(e){$e(r||(r=new Xe),2,e)}}(),r}(s,function(e){return n(s[e])})}(r,function(n){function r(){function r(){u.tempId!=n.tempId&&delete t.accounts[u.tempId]}var s=function(){if(Array.isArray(n))return Promise.resolve(e(t,n,u,a-1)).then(function(){});t.accounts[n.tempId]=t.accounts[n.tempId]||n,t.accounts[n.tempId].role.proposer=t.accounts[n.tempId].role.proposer||n.role.proposer,t.accounts[n.tempId].role.payer=t.accounts[n.tempId].role.payer||n.role.payer,t.accounts[n.tempId].role.authorizer=t.accounts[n.tempId].role.authorizer||n.role.authorizer,t.accounts[n.tempId].role.proposer&&t.proposer===u.tempId&&(t.proposer=n.tempId),t.accounts[n.tempId].role.payer&&t.payer===u.tempId&&(t.payer=n.tempId),t.accounts[n.tempId].role.authorizer&&(o?i=[].concat(i,[n.tempId]):t.authorizations=t.authorizations.map(function(e){return e===u.tempId?n.tempId:e}))}();return s&&s.then?s.then(r):r()}var u=o||n,s=function(){if(nn(n.resolve))return Promise.resolve(n.resolve(n,function(e,n){try{return{f_type:"PreSignable",f_vsn:"1.0.0",roles:e.role,cadence:n.message.cadence,args:n.message.arguments.map(function(e){return n.arguments[e].asArgument}),data:{},interaction:n}}catch(e){throw console.error("buildPreSignable",e),e}}(n,t))).then(function(e){n=e})}();return s&&s.then?s.then(r):r()});return Promise.resolve(s&&s.then?s.then(u):u())}catch(e){return Promise.reject(e)}},nn=function(e){return"function"==typeof e},tn=function(e,n){return Buffer.from(e.padStart(2*n,0),"hex")},rn=function(e){return tn(e,8)},on=function(e){return Buffer.from(JSON.stringify(e),"utf8")},an=function(e){return Buffer.from(e,"utf8")},un=function(e){return I(e).toString("hex")},sn=function(e){return fn(e),[an(e.script),e.arguments.map(on),(n=e.refBlock,tn(n,32)),e.gasLimit,rn(e.proposalKey.address),e.proposalKey.keyId,e.proposalKey.sequenceNum,rn(e.payer),e.authorizers.map(rn)];var n},cn=function(e){var n=ln(e);return e.payloadSigs.map(function(e){return{signerIndex:n.get(e.address),keyId:e.keyId,sig:e.sig}}).sort(function(e,n){return e.signerIndex>n.signerIndex?1:e.signerIndex<n.signerIndex?-1:e.keyId>n.keyId?1:e.keyId<n.keyId?-1:void 0}).map(function(e){return[e.signerIndex,e.keyId,(n=e.sig,Buffer.from(n,"hex"))];var n})},ln=function(e){var n=new Map,t=0,r=function(e){n.has(e)||(n.set(e,t),t++)};return r(e.proposalKey.address),r(e.payer),e.authorizers.forEach(r),n},fn=function(e){hn.forEach(function(n){return kn(e,n)}),vn.forEach(function(n){return kn(e.proposalKey,n,"proposalKey")})},dn=function(e){return"number"==typeof e},mn=function(e){return"string"==typeof e},gn=function(e){return null!==e&&"object"==typeof e},pn=function(e){return gn(e)&&e instanceof Array},hn=[{name:"script",check:mn},{name:"arguments",check:pn},{name:"refBlock",check:mn,defaultVal:"0"},{name:"gasLimit",check:dn},{name:"proposalKey",check:gn},{name:"payer",check:mn},{name:"authorizers",check:pn}],vn=[{name:"address",check:mn},{name:"keyId",check:dn},{name:"sequenceNum",check:dn}],yn=[{name:"payloadSigs",check:pn}],bn=[{name:"address",check:mn},{name:"keyId",check:dn},{name:"sig",check:mn}],kn=function(e,n,t,r){var o=n.name,a=n.check,u=n.defaultVal;if(null==e[o]&&null!=u&&(e[o]=u),null==e[o])throw Pn(o,t,r);if(!a(e[o]))throw Sn(o,t,r)},In=function(e,n,t){return n?null==t?n+"."+e:n+"."+t+"."+e:e},Pn=function(e,n,t){return new Error("Missing field "+In(e,n,t))},Sn=function(e,n,t){return new Error("Invalid field "+In(e,n,t))},wn=function(e){try{var n=function(){if(ee(e))return function(n,t){try{var r=(a=function(e){var n=new Set(e.authorizations);return n.add(e.proposer),n.delete(e.payer),Array.from(n)}(e),o=Bn(e),u=un(sn(o)),Promise.resolve(Promise.all(a.map(An(e,u)))).then(function(){var n=function(e){var n=new Set([e.payer]);return Array.from(n)}(e),t=function(e){return un(function(e){return function(e){yn.forEach(function(n){return kn(e,n)}),e.payloadSigs.forEach(function(e,n){bn.forEach(function(t){return kn(e,t,"payloadSigs",n)})})}(e),[sn(e),cn(e)]}(e))}(S({},Bn(e),{payloadSigs:a.map(function(n){return{address:e.accounts[n].addr,keyId:e.accounts[n].keyId,sig:e.accounts[n].signature}})}));return Promise.resolve(Promise.all(n.map(An(e,t)))).then(function(){})}))}catch(e){return t(e)}var o,a,u;return r&&r.then?r.then(void 0,t):r}(0,function(n){throw console.error("Signatures",n,{ix:e}),n})}();return Promise.resolve(n&&n.then?n.then(function(n){return e}):e)}catch(e){return Promise.reject(e)}};function An(e,n){return function(t){try{var r=e.accounts[t];return null!=r.signature?Promise.resolve():Promise.resolve(r.signingFunction(function(e,n,t){try{return{f_type:"Signable",f_vsn:"1.0.0",message:n,addr:v(e.addr),keyId:e.keyId,roles:e.role,cadence:t.message.cadence,args:t.message.arguments.map(function(e){return t.arguments[e].asArgument}),data:{},interaction:t}}catch(e){throw console.error("buildSignable",e),e}}(r,n,e))).then(function(n){e.accounts[t].signature=n.signature})}catch(e){return Promise.reject(e)}}}function Bn(e){return{script:e.message.cadence,refBlock:e.message.refBlock||null,gasLimit:e.message.computeLimit,arguments:e.message.arguments.map(function(n){return e.arguments[n].asArgument}),proposalKey:{address:v(e.accounts[e.proposer].addr),keyId:e.accounts[e.proposer].keyId,sequenceNum:e.accounts[e.proposer].sequenceNum},payer:v(e.accounts[e.payer].addr),authorizers:e.authorizations.map(function(n){return v(e.accounts[n].addr)}).reduce(function(e,n){return e.find(function(e){return e===n})?e:[].concat(e,[n])},[])}}var Tn=function(e){try{var n=ve(e,"ix.validators",[]);return Promise.resolve(pe(e,n.map(function(e){return function(n){return e(n,{Ok:L,Bad:_})}})))}catch(e){return Promise.reject(e)}},xn=pe([He,Me,Ze,function(e){try{var n=function(){if(ee(e)&&null==e.message.refBlock)return Promise.resolve(je([Oe()],opts).then(ze)).then(function(n){e.message.refBlock=n.id})}();return Promise.resolve(n&&n.then?n.then(function(){return e}):e)}catch(e){return Promise.reject(e)}},function(e){try{var t=function(){if(ee(e)){var t=Object.values(e.accounts).find(function(e){return e.role.proposer});n(t,"Transactions require a proposer");var r=function(){if(null==t.sequenceNum)return Promise.resolve(Ie([Le(t.addr)])).then(function(n){return Promise.resolve(je(n).then(ze).then(function(e){return e.keys}).then(function(e){return e.find(function(e){return e.index===t.keyId})}).then(function(e){return e.sequenceNumber})).then(function(n){e.accounts[t.tempId].sequenceNum=n})})}();if(r&&r.then)return r.then(function(){})}}();return Promise.resolve(t&&t.then?t.then(function(){return e}):e)}catch(e){return Promise.reject(e)}},wn,function(e){try{for(var n=0,t=Object.keys(e.accounts);n<t.length;n++){var r=t[n];e.accounts[r].addr=v(e.accounts[r].addr)}return Promise.resolve(e)}catch(e){return Promise.reject(e)}},Tn]),Nn=function(n,t){void 0===n&&(n=[]),void 0===t&&(t={});try{return Promise.resolve(e().get("sdk.send",t.send||je)).then(function(r){return Promise.resolve(e().get("sdk.resolve",t.resolve||xn)).then(function(e){return Array.isArray(n)&&(n=pe(T(),n)),Promise.resolve(e(n)).then(function(e){return r(e,t)})})})}catch(e){return Promise.reject(e)}},En=function(n){try{return Promise.resolve(e().where(/^decoder\./)).then(function(e){var t=Object.entries(e).map(function(e){var n=e[0],t=e[1];return[n="/"+n.replace(/^decoder\./,"")+"$/",t]});return ze(n,Object.fromEntries(t))})}catch(e){return Promise.reject(e)}};function jn(){var e=[].slice.call(arguments),n=e[1]||("object"==typeof e[0]?e[0]:void 0),t="boolean"==typeof e[0]?e[0]:void 0;return"object"!=typeof e[0]&&console.warn("\n      %cFCL/SDK Deprecation Notice\n      ============================\n  \n      Passing options as the first arguement to the latestBlock function has been deprecated and will be removed in future versions of the Flow JS-SDK/FCL.\n      You can learn more (including a guide on common transition paths) here: https://github.com/onflow/flow-js-sdk/blob/master/packages/sdk/TRANSITIONS.md#0007-deprecate-opts-first-arg-latest-block\n  \n      ============================\n    ","font-weight:bold;font-family:monospace;"),Nn([Oe(t)],n).then(ze)}function On(e,n){return Nn([Le(e)],n).then(ze)}var Ln={authorizer:!0};function _n(e){return void 0===e&&(e=[]),pe(e.map(function(e){return n="function"==typeof e?{resolve:e,role:Ln,roles:Ln}:S({},e,{role:Ln,roles:Ln}),function(e){var t=O();return e.authorizations.push(t),L(pe(e,[C(n,t)]))};var n}))}function Un(e,n,t,r){return{addr:e,signingFunction:n,keyId:t,sequenceNum:r}}function Cn(e){return be("ix.validators",function(n){return Array.isArray(n)?n.push(e):[e]})}function Kn(e){return pe([function(n){return n.block.height=e,L(n)},Cn(function(e,n){var t=n.Ok,r=n.Bad;return"boolean"==typeof e.block.isSealed?r(e,"Unable to specify both block height and isSealed."):e.block.id?r(e,"Unable to specify both block height and block id."):t(e)})])}function Rn(e){return pe([function(n){return n.block.id=e,L(n)},Cn(function(e,n){var t=n.Ok,r=n.Bad;return re(e)?r(e,"Unable to specify a block id with a Get Account interaction."):"boolean"==typeof e.block.isSealed?r(e,"Unable to specify both block id and isSealed."):e.block.height?r(e,"Unable to specify both block id and block height."):t(e)})])}function Dn(e,n,t){return void 0===n&&void 0===t||console.warn("\n      %cFCL/SDK Deprecation Notice\n      ============================\n  \n      Passing a start and end into getEnvents has been deprecated and will not be supported in future versions of the Flow JS-SDK/FCL.\n      You can learn more (including a guide on common transition paths) here: https://github.com/onflow/flow-js-sdk/blob/master/packages/sdk/TRANSITIONS.md#0005-deprecate-start-end-get-events-builder\n  \n      ============================\n    ","font-weight:bold;font-family:monospace;"),pe([q,function(r){return r.events.eventType=e,r.events.start=n,r.events.end=t,L(r)}])}function Gn(e,n,t){return pe([q,function(r){return r.events.eventType=e,r.events.start=n,r.events.end=t,L(r)}])}function zn(e){return void 0===e&&(e=[]),pe([q,function(n){return n.events.eventType=eventType,n.events.blockIds=e,L(n)}])}function Fn(e){return void 0===e&&(e=null),pe([$,function(n){return n.block.isSealed=e,L(n)}])}function Hn(e){return void 0===e&&(e=!1),console.warn("\n    %cFCL/SDK Deprecation Notice\n    ============================\n\n    The getLatestBlock builder has been deprecated and will be removed in future versions of the Flow JS-SDK/FCL.\n    You can learn more (including a guide on common transition paths) here: https://github.com/onflow/flow-js-sdk/blob/master/packages/sdk/TRANSITIONS.md#0006-deprecate-get-latest-block-builder\n\n    ============================\n  ","font-weight:bold;font-family:monospace;"),pe([J,function(n){return n.block.isSealed=e,L(n)}])}function qn(e){return console.warn("\n    %cFCL/SDK Deprecation Notice\n    ============================\n\n    The getBlockById builder has been deprecated and will be removed in future versions of the Flow JS-SDK/FCL.\n    You can learn more (including a guide on common transition paths) here: https://github.com/onflow/flow-js-sdk/blob/master/packages/sdk/TRANSITIONS.md#0004-deprecate-get-block-by-id-builder\n\n    ============================\n  ","font-weight:bold;font-family:monospace;"),pe([M,function(n){return n.block.ids=[e],L(n)}])}function Jn(e){return console.warn("\n    %cFCL/SDK Deprecation Notice\n    ============================\n\n    The getBlockByHeight builder has been deprecated and will be removed in future versions of the Flow JS-SDK/FCL.\n    You can learn more (including a guide on common transition paths) here: https://github.com/onflow/flow-js-sdk/blob/master/packages/sdk/TRANSITIONS.md#0003-deprecate-get-block-by-height-builder\n\n    ============================\n  ","font-weight:bold;font-family:monospace;"),pe([W,function(n){return n.block.height=e,L(n)}])}function Mn(e){return pe([z,function(n){return n.transaction.id=e,L(n)}])}function Wn(e){return pe([F,function(n){return n.transaction.id=e,L(n)}])}function Yn(e){return pe([function(n){return n.message.computeLimit=e,L(n)}])}function Vn(e){return void 0===e&&(e=[]),pe(e.map(K))}function $n(e,n,t){return void 0===t&&(t=null),{key:t,value:e,xform:null}}function Xn(e){return void 0===e&&(e=[]),pe(e.map(R))}function Qn(e,n){return{value:e,xform:n}}var Zn=function(e){try{return Promise.resolve((n="function"==typeof e?{resolve:e,role:et,roles:et}:S({},e,{role:et,roles:et}),function(e){var t=O();return e.proposer=t,L(pe(e,[C(n,t)]))}))}catch(e){return Promise.reject(e)}var n},et={proposer:!0},nt={payer:!0};function tt(e){return n="function"==typeof e?{resolve:e,role:nt,roles:nt}:S({},e,{role:nt,roles:nt}),function(e){var t=O();return e.payer=t,L(pe(e,[C(n,t)]))};var n}function rt(){return Y}function ot(e){return pe([function(n){return n.message.refBlock=e,L(n)}])}function at(){return pe([D,ye("ix.cadence",P.apply(void 0,[].slice.call(arguments)))])}var ut=[];function it(){return pe([G,ye("ix.cadence",P.apply(void 0,[].slice.call(arguments))),function(e){return e.message.computeLimit=e.message.computeLimit||10,e.message.refBlock=e.message.refBlock||null,e.authorizations=e.authorizations||ut,L(e)}])}function st(){var e=[].slice.call(arguments);if(e.length>1){var n=e,t=n[0],r=n[1];return st(function(e,n){var o=n.Bad;return t?(0,n.Ok)(e):o(e,r)})}var o=e[0];return function(e){return o(e,{Ok:L,Bad:_})}}function ct(e){return console.error("\n      %cFCL/SDK Deprecation Notice\n      ============================\n\n      The resolver sdk.resolveParams is being replaced with the package @onflow/sdk-resolve-cadence\n      You can learn more (including a guide on common transition paths) here: https://github.com/onflow/flow-js-sdk/blob/master/packages/sdk/TRANSITIONS.md#0002-deprecate-resolve-params-resolver\n\n      ============================\n    ","font-weight:bold;font-family:monospace;"),He(e)}export{On as account,Qn as arg,Xn as args,Kn as atBlockHeight,Rn as atBlockId,Un as authorization,_n as authorizations,Ie as build,En as decode,ke as destroy,ve as get,Le as getAccount,Oe as getBlock,Jn as getBlockByHeight,qn as getBlockById,Fn as getBlockHeader,Dn as getEvents,Gn as getEventsAtBlockHeightRange,zn as getEventsAtBlockIds,Hn as getLatestBlock,Wn as getTransaction,Mn as getTransactionStatus,T as interaction,st as invariant,de as isBad,re as isGetAccount,ce as isGetBlock,ie as isGetBlockByHeight,ue as isGetBlockById,le as isGetBlockHeader,oe as isGetEvents,ae as isGetLatestBlock,te as isGetTransaction,ne as isGetTransactionStatus,fe as isOk,se as isPing,Z as isScript,ee as isTransaction,Q as isUnknown,jn as latestBlock,Yn as limit,$n as param,Vn as params,tt as payer,rt as ping,pe as pipe,Zn as proposer,ye as put,ot as ref,xn as resolve,Ze as resolveAccounts,Me as resolveArguments,ct as resolveParams,Fe as resolveRefBlockId,wn as resolveSignatures,Tn as resolveValidators,at as script,Nn as send,it as transaction,be as update,Cn as validator,me as why};
//# sourceMappingURL=sdk.module.js.map
